{% extends 'trends_viewer/base.html' %}

{% block title %}Save Current Preferences - AI Trend Intelligence{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 2rem auto;">
    <h2 style="margin-bottom: 1.5rem;">üíæ Save Current Filter Settings</h2>

    <div class="card" style="margin-bottom: 2rem; background: #e3f2fd; border-left: 4px solid #2196f3;">
        <p style="margin-bottom: 0.5rem; font-weight: 600; color: #1976d2;">
            ‚ÑπÔ∏è What you're saving:
        </p>
        <p style="color: #666; font-size: 0.9rem;">
            Your current filter settings will be saved as a reusable preference profile.
            You can activate this profile anytime to quickly restore these exact settings.
        </p>
    </div>

    <!-- Current Preferences Preview -->
    <div class="card" style="margin-bottom: 2rem;">
        <h3 style="margin-bottom: 1rem;">Current Filter Settings</h3>

        <div style="display: grid; gap: 1rem; font-size: 0.9rem;">
            {% if current_prefs.sources %}
            <div>
                <strong>Sources:</strong>
                <span style="color: #666;">{{ current_prefs.sources|join:", " }}</span>
            </div>
            {% endif %}

            {% if current_prefs.languages %}
            <div>
                <strong>Languages:</strong>
                <span style="color: #666;">{{ current_prefs.languages|join:", " }}</span>
            </div>
            {% endif %}

            <div>
                <strong>Time Range:</strong>
                <span style="color: #666;">{{ current_prefs.time_range }}</span>
            </div>

            {% if current_prefs.keywords_include %}
            <div>
                <strong>Include Keywords:</strong>
                <span style="color: #666;">{{ current_prefs.keywords_include|join:", " }}</span>
            </div>
            {% endif %}

            {% if current_prefs.keywords_exclude %}
            <div>
                <strong>Exclude Keywords:</strong>
                <span style="color: #666;">{{ current_prefs.keywords_exclude|join:", " }}</span>
            </div>
            {% endif %}

            {% if current_prefs.min_upvotes > 0 or current_prefs.min_comments > 0 or current_prefs.min_score > 0 %}
            <div>
                <strong>Minimum Metrics:</strong>
                <span style="color: #666;">
                    {% if current_prefs.min_upvotes > 0 %}Upvotes: {{ current_prefs.min_upvotes }}{% endif %}
                    {% if current_prefs.min_comments > 0 %}Comments: {{ current_prefs.min_comments }}{% endif %}
                    {% if current_prefs.min_score > 0 %}Score: {{ current_prefs.min_score }}{% endif %}
                </span>
            </div>
            {% endif %}

            <div>
                <strong>Sort:</strong>
                <span style="color: #666;">{{ current_prefs.sort_by }} ({{ current_prefs.sort_order }})</span>
            </div>
        </div>
    </div>

    <!-- Save Form -->
    <div class="card">
        <h3 style="margin-bottom: 1.5rem;">Save As New Profile</h3>

        <form method="post">
            {% csrf_token %}

            <div style="margin-bottom: 1.5rem;">
                <label for="{{ form.profile_name.id_for_label }}" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                    Profile Name <span style="color: #f44336;">*</span>
                </label>
                {{ form.profile_name }}
                <small style="display: block; color: #999; margin-top: 0.25rem;">
                    E.g., "My AI Feed", "Work Topics", "Weekend Reading"
                </small>
                {% if form.profile_name.errors %}
                <div style="color: #f44336; margin-top: 0.5rem; font-size: 0.875rem;">
                    {{ form.profile_name.errors }}
                </div>
                {% endif %}
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label for="{{ form.description.id_for_label }}" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                    Description (Optional)
                </label>
                {{ form.description }}
                <small style="display: block; color: #999; margin-top: 0.25rem;">
                    Add a note to help remember what this profile is for
                </small>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    {{ form.set_as_default }}
                    <span style="margin-left: 0.5rem; font-weight: 600;">Set as my default profile</span>
                </label>
                <small style="display: block; color: #999; margin-top: 0.25rem; margin-left: 1.5rem;">
                    This profile will automatically load when you log in
                </small>
            </div>

            <div style="display: flex; gap: 1rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
                <button type="submit" class="btn btn-primary">
                    üíæ Save Profile
                </button>
                <a href="{% url 'trends_viewer:user_profile' %}" class="btn btn-outline">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<style>
    .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    .form-input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    .form-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    .btn {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s;
    }
    .btn-primary {
        background: #3498db;
        color: white;
    }
    .btn-primary:hover {
        background: #2980b9;
    }
    .btn-outline {
        background: white;
        color: #3498db;
        border: 2px solid #3498db;
    }
    .btn-outline:hover {
        background: #3498db;
        color: white;
    }
</style>
{% endblock %}
