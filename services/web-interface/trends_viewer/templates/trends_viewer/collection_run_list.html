{% extends 'trends_viewer/base.html' %}

{% block title %}Collection History - AI Trend Intelligence{% endblock %}

{% block content %}
<h2 style="margin-bottom: 1.5rem;">Collection Run History</h2>

{% if runs %}
<div class="card">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #e0e0e0;">
                <th style="padding: 0.75rem; text-align: left;">ID</th>
                <th style="padding: 0.75rem; text-align: left;">Timestamp</th>
                <th style="padding: 0.75rem; text-align: left;">Status</th>
                <th style="padding: 0.75rem; text-align: left;">Topics</th>
                <th style="padding: 0.75rem; text-align: left;">Clusters</th>
                <th style="padding: 0.75rem; text-align: left;">Duration</th>
                <th style="padding: 0.75rem; text-align: left;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for run in runs %}
            <tr style="border-bottom: 1px solid #e0e0e0;">
                <td style="padding: 0.75rem;">#{{ run.id }}</td>
                <td style="padding: 0.75rem;">{{ run.timestamp|date:"Y-m-d H:i:s" }}</td>
                <td style="padding: 0.75rem;">
                    <span class="badge badge-{% if run.status == 'completed' %}success{% elif run.status == 'running' %}warning{% else %}danger{% endif %}">
                        {{ run.status|title }}
                    </span>
                </td>
                <td style="padding: 0.75rem;">{{ run.topics_count }}</td>
                <td style="padding: 0.75rem;">{{ run.clusters_count }}</td>
                <td style="padding: 0.75rem;">
                    {% if run.duration_seconds %}
                        {{ run.duration_seconds|floatformat:1 }}s
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td style="padding: 0.75rem;">
                    {% if run.status == 'completed' %}
                    <a href="{% url 'trends_viewer:trend_list' %}?run={{ run.id }}" style="color: #3498db; text-decoration: none; font-size: 0.875rem;">
                        View Trends
                    </a>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% if run.error_message %}
            <tr>
                <td colspan="7" style="padding: 0.5rem 0.75rem; background: #fff3cd; color: #856404; font-size: 0.875rem;">
                    Error: {{ run.error_message }}
                </td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
<div style="margin-top: 2rem; text-align: center;">
    <div style="display: inline-flex; gap: 0.5rem;">
        {% if page_obj.has_previous %}
        <a href="?page=1" style="padding: 0.5rem 1rem; background: #3498db; color: white; text-decoration: none; border-radius: 4px;">First</a>
        <a href="?page={{ page_obj.previous_page_number }}" style="padding: 0.5rem 1rem; background: #3498db; color: white; text-decoration: none; border-radius: 4px;">Previous</a>
        {% endif %}

        <span style="padding: 0.5rem 1rem; background: #ecf0f1; border-radius: 4px;">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" style="padding: 0.5rem 1rem; background: #3498db; color: white; text-decoration: none; border-radius: 4px;">Next</a>
        <a href="?page={{ page_obj.paginator.num_pages }}" style="padding: 0.5rem 1rem; background: #3498db; color: white; text-decoration: none; border-radius: 4px;">Last</a>
        {% endif %}
    </div>
</div>
{% endif %}

{% else %}
<div class="card">
    <p style="text-align: center; color: #666; padding: 2rem;">No collection runs found. Run the collection command to gather data.</p>
</div>
{% endif %}

{% endblock %}
